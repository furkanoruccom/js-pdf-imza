<!DOCTYPE html>
<html lang="tr">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta charset="UTF-8">
    <title>PDF Üzerine İmza Yerleştirme</title>

    <style>
            body {
            background-color: black;
        }

        #pdfCanvas {
            position: relative;
        }

        .selectionArea {
            position: absolute;
            top: 200px;
            width: 100px;
            height: 100px;
            border: 2px dashed blue;
            cursor: move;

        }

        button {
            padding: 10px 20px;
            background-color: #fff;
            color: #000;
            text-decoration: none;
            border-radius: 5px;
            font-size: 20px;
        }


        .signatureWrapper {
            cursor: move;
            /* Görsellik için */
            touch-action: none;

        }

        .signatureWrapper .fa-trash {
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 20px;
            color: red;
        }

        .signature {
            width: 100%;
            height: 100%;
        }

        .resize-handle {
            position: absolute;
            bottom: 0;
            right: 0;
        }

        .rotate-handle {
            position: absolute;
            top: -20px;
            left: -20px;
            width: 20px;
            height: 20px;
            font-size: 20px;

            cursor: pointer;
        }
    </style>

    <!-- Gerekli Kütüphanelerin Bağlantıları -->
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js"></script>
    <script src="jspdf.min.js"></script>
    <script src="html2canvas.min.js"></script>
</head>
<body>
    <div id="pdfCanvasContainer" style="width: 476px; height: 673px; position: relative;">
        <canvas id="pdfCanvas"></canvas>
        <div class="selectionArea" id="selectionArea"></div>
    </div>
    <br />
    <button id="placeSignature">İmzayı Yerleştir</button>
    <button id="download_btn">PDF İndir</button>
    <button id="prevPage">Önceki Sayfa</button>
    <button id="nextPage">Sonraki Sayfa</button>
    <div id="page_num"></div>

    <script>
        var pdfCanvas = document.getElementById('pdfCanvas');
        var selectionArea = document.getElementById('selectionArea');
        var canvasContext = pdfCanvas.getContext('2d');
        var pageNum = 1, pdfDoc = null, scale = 0.8;

        // PDF'i yükleme ve gösterme
        function renderPDF() {
            pdfjsLib.getDocument('your-pdf-file.pdf').promise.then(function (pdfDoc_) {
                pdfDoc = pdfDoc_;
                pdfDoc.getPage(pageNum).then(function (page) {
                    var viewport = page.getViewport({ scale: scale });
                    pdfCanvas.height = viewport.height;
                    pdfCanvas.width = viewport.width;
                    var renderContext = { canvasContext: canvasContext, viewport: viewport };
                    page.render(renderContext).then(function () {
                        updatePageNumber();
                    });
                });
            });
        }

        // Sayfa numarasını güncelleme
        function updatePageNumber() {
            document.getElementById('page_num').textContent = 'Sayfa ' + pageNum + ' / ' + pdfDoc.numPages;
        }

        // Önceki ve sonraki sayfa butonları için işlevsellik
        document.getElementById('prevPage').addEventListener('click', function() {
            if (pageNum <= 1) return;
            pageNum--;
            renderPDF();
        });

        document.getElementById('nextPage').addEventListener('click', function() {
            if (pageNum >= pdfDoc.numPages) return;
            pageNum++;
            renderPDF();
        });

        // İmza yerleştirme
        document.getElementById('placeSignature').addEventListener('click', function () {
            var x = parseInt(selectionArea.style.left, 10);
            var y = parseInt(selectionArea.style.top, 10);
            var signatureElement = createSignatureElement('your-signature-image.png', x, y);
            pdfCanvas.parentElement.appendChild(signatureElement);
        });

        // İmza elementi oluşturma
        function createSignatureElement(src, x, y) {
            var img = new Image();
            img.src = src;
            img.style.position = 'absolute';
            img.style.left = x + 'px';
            img.style.top = y + 'px';
            return img;
        }

        // PDF indirme
        document.getElementById('download_btn').addEventListener('click', function() {
            var pdf = new jsPDF();
            downloadPDF(pdf, 1);
        });

        function downloadPDF(pdf, num) {
            if (num > pdfDoc.numPages) {
                pdf.save('download.pdf');
                return;
            }

            pdfDoc.getPage(num).then(function(page) {
                var viewport = page.getViewport({ scale: scale });
                var canvas = document.createElement('canvas');
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                var context = canvas.getContext('2d');

                var renderContext = { canvasContext: context, viewport: viewport };
                page.render(renderContext).then(function () {
                    pdf.addImage(canvas.toDataURL('image/jpeg'), 'JPEG', 0, 0);

                    if (num < pdfDoc.numPages) {
                        pdf.addPage();
                    }

                    downloadPDF(pdf, num + 1);
                });
            });
        }

        // İlk sayfayı göster
        renderPDF();
    </script>
</body>
</html>
